<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunaBot Autonomous Navigation</title>
    <style>
        :root {
            --primary-accent: #c5a347;
            --bg-dark: #0d1117;
            --bg-gradient: linear-gradient(135deg, #0d1117 0%, #010409 100%);
            --primary-green: #238636;
            --danger-red: #da3633;
            --card-bg: rgba(22, 27, 34, 0.7);
            --card-border: rgba(197, 163, 71, 0.2);
            --card-hover: #161b22;
            --text-primary: #e6edf3;
            --text-secondary: #bdc6d3;
            --text-muted: #848d97;
            --shimmer-bg: #161b22;
        }

        [data-theme="light"] {
            --primary-accent: #8c7028;
            --bg-dark: #f0f2f5;
            --bg-gradient: linear-gradient(135deg, #e9eef5 0%, #f0f2f5 100%);
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-border: rgba(0, 0, 0, 0.1);
            --card-hover: #ffffff;
            --text-primary: #1c1e21;
            --text-secondary: #555c6e;
            --text-muted: #65676b;
            --shimmer-bg: #e0e0e0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        #scroll-progress-bar {
            position: fixed; top: 0; left: 0; height: 4px; background: var(--primary-accent);
            width: 0%; z-index: 1000; transition: width 0.1s linear;
        }

        .hero {
            height: 100vh; min-height: 700px; width: 100vw; display: flex;
            align-items: center; justify-content: center; background: var(--bg-gradient);
            position: relative; overflow: hidden;
        }
        .hero::before {
            content: ''; position: absolute; top: 10%; left: 15%; width: 100px; height: 100px;
            background: url(https://assets.codepen.io/39255/moon.png) no-repeat center center;
            background-size: contain; animation: slow-spin 120s linear infinite; z-index: 0;
        }
        .hero::after {
            content: ''; position: absolute; bottom: -150px; right: -150px; width: 500px; height: 500px;
            background: url(https://assets.codepen.io/39255/earth.png) no-repeat center center;
            background-size: contain; animation: slow-spin 180s linear infinite reverse; z-index: 0;
        }
        #particles-js { position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1; }

        .hero-content {
            display: flex; width: 100%; max-width: 1600px; padding: 0 50px;
            justify-content: space-between; align-items: center; z-index: 2;
        }
        .hero-left { text-align: left; max-width: 650px; }
        .hero-title { font-size: clamp(2.5rem, 5vw, 3.5rem); font-weight: 700; color: var(--text-primary); margin-bottom: 1rem; }
        .hero-subtitle { font-size: clamp(1.2rem, 3vw, 1.5rem); color: var(--primary-accent); font-weight: 400; margin-bottom: 1.5rem; }
        .hero-description { font-size: 1.1rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 2.5rem; }

        .rover-container { perspective: 1000px; }
        .rover-image { width: 550px; height: 450px; cursor: grab; }

        .launch-button {
            display: inline-block; margin-top: 1.5rem; z-index: 2; padding: 12px 24px;
            background-color: var(--primary-accent); color: var(--bg-dark); text-decoration: none;
            font-weight: 600; border-radius: 8px; transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(197, 163, 71, 0.3);
        }
        .launch-button:hover { transform: scale(1.05); box-shadow: 0 6px 25px rgba(197, 163, 71, 0.4); }

        .sticky-header {
            position: sticky; top: 0; width: 100%; z-index: 100; display: flex;
            justify-content: space-between; align-items: center; padding: 15px 40px;
            background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
        }
        .sticky-header h2 { font-size: 1.5rem; color: var(--text-primary); }
        .connection-status { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: var(--text-muted); }
        #connection-text-header { font-weight: 600; transition: color 0.5s ease; }
        #connection-text-header.connected { color: var(--primary-green); }
        #connection-text-header.disconnected { color: var(--danger-red); }

        .dashboard-container { padding: 40px; min-height: 100vh; background: var(--bg-dark); }
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; width: 100%;
            max-width: 1800px; margin: 0 auto;
        }
        .card {
            background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px;
            transition: transform 0.3s ease, box-shadow 0.3s ease; overflow: hidden; opacity: 0; transform: translateY(50px);
        }
        .card:hover { transform: translateY(-5px) !important; box-shadow: 0 10px 30px rgba(0,0,0,0.3), 0 0 20px var(--card-border); }
        .tall-card { grid-row: span 2; }
        .card-header { display: flex; align-items: center; gap: 12px; padding: 15px 20px; border-bottom: 1px solid var(--card-border); }
        .card-header-icon { width: 20px; height: 20px; fill: var(--text-muted); }
        .card-header h3 { font-size: 1.1rem; font-weight: 600; color: var(--text-secondary); flex-grow: 1; }
        .card-header .status-text, .card-header .live-indicator { margin-left: auto; }
        .card-content { padding: 20px; }

        .d-pad { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 10px; height: 150px; }
        .d-pad button {
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--card-border); color: var(--text-secondary);
            font-size: 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;
        }
        .d-pad button:hover { background: var(--primary-accent); color: var(--bg-dark); transform: scale(1.05); box-shadow: 0 0 15px var(--primary-accent); }
        .d-pad button:active { transform: scale(0.95); }
        #move-forward { grid-area: 1 / 2 / 2 / 3; }
        #move-left { grid-area: 2 / 1 / 3 / 2; }
        #stop { grid-area: 2 / 2 / 3 / 3; background: rgba(218, 54, 51, 0.3); }
        #stop:hover { background: var(--danger-red); box-shadow: 0 0 15px var(--danger-red); }
        #move-right { grid-area: 2 / 3 / 3 / 4; }
        #move-backward { grid-area: 3 / 2 / 4 / 3; }

        .expand-btn { width: 100%; margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--card-border); color: var(--text-muted); border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
        .expand-btn:hover { background: var(--card-hover); }
        .advanced-controls { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
        .advanced-controls.expanded { max-height: 300px; }

        .slider-group, .input-group { margin-top: 15px; }
        .slider-group label, .input-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-muted); }
        input[type="range"] { width: 100%; cursor: pointer; }
        input[type="number"] { width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid var(--card-border); border-radius: 4px; color: var(--text-primary); }

        .canvas-container { padding: 0; position: relative; }
        .shimmer-wrapper { animation: shimmer 1.5s infinite linear; background: var(--shimmer-bg); }
        canvas { display: block; width: 100%; height: 100%; background-color: #000; }
        .live-indicator { display: inline-flex; align-items: center; font-size: 0.8rem; color: var(--danger-red); }
        .live-indicator::before { content: ''; width: 8px; height: 8px; background: var(--danger-red); border-radius: 50%; margin-right: 5px; animation: pulse 1.5s infinite; }
        .fullscreen-btn { background: none; border: none; color: var(--text-muted); font-size: 1.2rem; cursor: pointer; padding: 0; line-height: 1; }
        .card.fullscreen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; border-radius: 0; }

        .goal-pad button, .cta-btn {
            padding: 12px; background: rgba(197,163,71,0.1); border: 1px solid var(--primary-accent);
            color: var(--primary-accent); border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s ease;
        }
        .goal-pad button:hover, .cta-btn:hover { background: var(--primary-accent); color: var(--bg-dark); }
        .custom-goal { margin-top: 20px; display: flex; gap: 10px; }
        .custom-goal input { flex-grow: 1; }

        .goal-pad { display: grid; grid-template-columns: repeat(3,1fr); grid-template-rows: repeat(3,1fr); gap: 10px; height: 150px; }
        #goal-north { grid-area: 1 / 2 / 2 / 3; } #goal-west { grid-area: 2 / 1 / 3 / 2; } #goal-home { grid-area: 2 / 2 / 3 / 3; background: rgba(197,163,71,0.25); } #goal-east { grid-area: 2 / 3 / 3 / 4; } #goal-south { grid-area: 3 / 2 / 4 / 3; }

        .status-cards { display: flex; justify-content: space-around; text-align: center; margin-bottom: 20px; }
        .status-item h4 { color: var(--text-muted); font-weight: 400; font-size: 0.9rem; }
        .status-item p { font-size: 1.5rem; font-weight: 600; color: var(--primary-accent); }
        .status-rows p { margin-bottom: 8px; color: var(--text-secondary); }
        .status-rows span { font-weight: 600; color: var(--text-primary); }

        .detection-icons-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center; }
        .detection-item-icon svg { width: 48px; height: 48px; fill: var(--primary-accent); margin-bottom: 10px; transition: transform 0.3s ease; }
        .detection-item-icon:hover svg { transform: scale(1.1); }
        .detection-item-icon strong { display: block; font-size: 2rem; font-weight: 700; color: var(--text-primary); }
        .detection-item-icon span { font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }

        .log-container { height: 150px; overflow-y: auto; font-size: 0.9rem; }
        .log-container p { padding: 4px; border-radius: 3px; }
        .log-info { color: #eee } .log-success { color: var(--primary-green) } .log-error { color: var(--danger-red) }

        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 2000; }
        .toast { padding: 15px 20px; margin-bottom: 10px; border-radius: 8px; color: #fff; opacity: 0; transform: translateX(100%); animation: slideIn 0.5s forwards; }
        .toast.success { background: var(--primary-green); } .toast.error { background: var(--danger-red); }

        .theme-switcher { display: flex; justify-content: space-between; align-items: center; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #2c3e50; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
        input:checked + .slider { background-color: var(--primary-accent); }
        input:checked + .slider:before { transform: translateX(26px); }
        .slider.round { border-radius: 34px; } .slider.round:before { border-radius: 50%; }

        #pathMap .plotly .bg { fill: transparent !important; } #pathMap .plotly .gridlayer { stroke: rgba(255,255,255,0.1) !important; } #pathMap .plotly text { fill: var(--text-muted) !important; }

        @media (max-width: 1600px) {
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
            .card:nth-child(3n) { grid-column: span 1; }
            .card.tall-card { grid-row: span 1; height: 400px; }
        }
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .hero-content { flex-direction: column; text-align: center; padding-top: 80px; }
            .hero-left { margin-bottom: 2rem; } .rover-image { width: 400px; }
            .sticky-header { padding: 10px 20px; } .sticky-header h2 { font-size: 1.2rem; }
        }
        @media (max-width: 768px) {
            .hero-right { display: none; }
            .hero::after { width: 300px; height: 300px; bottom: -100px; right: -100px; }
            .dashboard-container { padding: 20px; } .sticky-header { top: 0; }
        }

        .card-content.fixed-height { height: 255px; display: flex; flex-direction: column; }
        .card-content.fixed-height > div { flex-grow: 1; min-height: 0; }

        @keyframes pulse { 0%,100%{ transform: scale(1); opacity: 1 } 50% { transform: scale(1.1); opacity: 0.7 } }
        @keyframes shimmer { 0% { background-position: -800px 0 } 100% { background-position: 800px 0 } }
        @keyframes slideIn { to { opacity: 1; transform: translateX(0) } }
        @keyframes slideOut { from { opacity: 1; transform: translateX(0) } to { opacity: 0; transform: translateX(100%) } }
        @keyframes breathing { 0%,100%{ box-shadow: 0 0 5px var(--primary-green) } 50%{ box-shadow: 0 0 15px var(--primary-green) } }
        @keyframes slow-spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }

        .shimmer-wrapper { position: relative; overflow: hidden; background-color: var(--shimmer-bg); }
        .shimmer-wrapper::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.05) 50%, transparent 100%); animation: shimmer 1.5s infinite; }
        #connection-indicator { width: 12px; height: 12px; border-radius: 50%; transition: background-color 0.5s ease; }
        #connection-indicator.connected { background-color: var(--primary-green); animation: breathing 2s infinite ease-in-out; }
        #connection-indicator.disconnected { background-color: var(--danger-red); }
    </style>
</head>
<body>
    <div id="scroll-progress-bar"></div>
    <div id="toast-container"></div>

    <section class="hero">
        <div id="particles-js"></div>
        <div class="hero-content">
            <div class="hero-left">
                <h1 class="hero-title">LunaBot Autonomous Navigation</h1>
                <p class="hero-subtitle">SLAM-Based Rover Control System</p>
                <p class="hero-description">Advanced autonomous navigation with real-time SLAM mapping, computer vision detection, and intelligent path planning. Experience cutting-edge robotics technology designed for lunar exploration and beyond.</p>
                <a href="#dashboard" class="launch-button">Launch Controls</a>
            </div>
            <div class="hero-right">
                <div class="rover-container">
                    <div id="rover-3d-container" class="rover-image"></div>
                </div>
            </div>
        </div>
    </section>

    <header class="sticky-header">
        <h2>Control Dashboard</h2>
        <div class="connection-status">
            <span>Status:</span>
            <div id="connection-indicator" class="disconnected"></div>
            <span id="connection-text-header" class="disconnected">Disconnected</span>
            <span style="margin-left: 15px;">|</span>
            <span style="margin-left: 15px;">üå°Ô∏è Temp: <strong id="moon-temp">- ¬∞C</strong></span>
        </div>
    </header>

    <main class="dashboard-container" id="dashboard">
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,9L8,13H11V15H13V13H16L12,9Z" /></svg>
                    <h3>Manual Control</h3>
                </div>
                <div class="card-content">
                    <div class="d-pad">
                        <button id="move-forward" onclick="moveForward()">‚¨Ü</button>
                        <button id="move-left" onclick="moveLeft()">‚¨Ö</button>
                        <button id="stop" class="stop-btn" onclick="emergencyStop()">üõë</button>
                        <button id="move-right" onclick="moveRight()">‚û°</button>
                        <button id="move-backward" onclick="moveBackward()">‚¨á</button>
                    </div>
                    <button class="expand-btn" id="expand-controls-btn">Advanced Controls ‚ñº</button>
                    <div class="advanced-controls" id="advanced-controls-panel">
                        <div class="slider-group">
                            <label>Linear Speed: <span id="linearValue">0.5</span></label>
                            <input type="range" id="customLinear" min="0" max="2" step="0.1" value="0.5">
                        </div>
                        <div class="slider-group">
                            <label>Angular Speed: <span id="angularValue">0.3</span></label>
                            <input type="range" id="customAngular" min="0" max="1" step="0.05" value="0.3">
                        </div>
                        <div class="input-group">
                            <label for="customDuration">Duration (s)</label>
                            <input type="number" id="customDuration" value="1" min="0.1" step="0.1">
                        </div>
                        <button class="cta-btn" onclick="sendCustomCommand()">Send Command</button>
                    </div>
                </div>
            </div>

            <div class="card tall-card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,2C15.31,2 18,4.69 18,8C18,12.5 12,22 12,22C12,22 6,12.5 6,8C6,4.69 8.69,2 12,2M12,4.5A3.5,3.5 0 0,0 8.5,8C8.5,9.93 10.33,13.25 12,15.9C13.67,13.25 15.5,9.93 15.5,8A3.5,3.5 0 0,0 12,4.5Z" /></svg>
                    <h3>SLAM Map</h3>
                    <span id="mapStatus" class="status-text"></span>
                    <button class="fullscreen-btn">‚õ∂</button>
                </div>
                <div class="card-content canvas-container">
                    <div class="shimmer-wrapper"><canvas id="slamMapCanvas"></canvas></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z" /></svg>
                    <h3>Camera Feed</h3>
                    <span class="live-indicator">LIVE</span>
                    <button class="fullscreen-btn">‚õ∂</button>
                </div>
                <div class="card-content canvas-container">
                    <div class="shimmer-wrapper"><canvas id="cameraCanvas"></canvas></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,12.5A1.5,1.5 0 0,1 10.5,11A1.5,1.5 0 0,1 12,9.5A1.5,1.5 0 0,1 13.5,11A1.5,1.5 0 0,1 12,12.5M12,4.5C15.86,4.5 19,7.63 19,11.5C19,15.36 15.86,18.5 12,18.5A7,7 0 0,1 5,11.5C5,7.63 8.13,4.5 12,4.5M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>
                    <h3>Navigation Goals</h3>
                </div>
                <div class="card-content">
                    <div class="goal-pad">
                        <button id="goal-north" onclick="sendGoal(0, 10)">North</button>
                        <button id="goal-west" onclick="sendGoal(-10, 0)">West</button>
                        <button id="goal-home" onclick="sendGoal(0, 0)">Home</button>
                        <button id="goal-east" onclick="sendGoal(10, 0)">East</button>
                        <button id="goal-south" onclick="sendGoal(0, -10)">South</button>
                    </div>
                    <div class="custom-goal">
                        <input type="number" id="goalX" placeholder="X Coordinate">
                        <input type="number" id="goalY" placeholder="Y Coordinate">
                        <button class="cta-btn" onclick="sendCustomGoal()">Set Custom Goal</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M2,2H11V11H2V2M4,4V9H9V4H4M13,2H22V11H13V2M15,4V9H20V4H15M2,13H11V22H2V13M4,15V20H9V15H4M17.5,13C15,13 13,15 13,17.5C13,20 15,22 17.5,22C20,22 22,20 22,17.5C22,15 20,13 17.5,13M17.5,15A2.5,2.5 0 0,1 20,17.5A2.5,2.5 0 0,1 17.5,20A2.5,2.5 0 0,1 15,17.5A2.5,2.5 0 0,1 17.5,15Z" /></svg>
                    <h3>Live Path Graph</h3>
                </div>
                <div class="card-content fixed-height">
                    <div id="pathMap"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M11,15V12H9V15H6V17H9V20H11V17H14V15H11Z" /></svg>
                    <h3>System Status</h3>
                </div>
                <div class="card-content fixed-height">
                    <div class="status-cards">
                        <div class="status-item">
                            <h4>Mode</h4>
                            <p id="missionMode">IDLE</p>
                        </div>
                        <div class="status-item">
                            <h4>Battery</h4>
                            <p id="missionBattery">100%</p>
                        </div>
                        <div class="status-item">
                            <h4>To Base</h4>
                            <p id="distanceToBase">0.0m</p>
                        </div>
                    </div>
                    <div class="status-rows">
                        <p>Position: <span id="positionDisplay">(0, 0, 0)</span></p>
                        <p>Velocity: <span id="velocityDisplay">(0, 0)</span></p>
                        <p>Rover Mode: <span id="modeDisplay">Manual</span></p>
                        <p>Connection: <span id="connectionDisplay" class="status-ok">OK</span></p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" /></svg>
                    <h3>Object Detection</h3>
                </div>
                <div class="card-content">
                    <div class="detection-icons-grid">
                        <div class="detection-item-icon">
                            <svg viewBox="0 0 24 24"><path d="M12.5,21.08C9.8,21.08 5,21.08 5,21.08C3.9,21.08 3,20.18 3,19.08V17.08C3,15.98 3.9,15.08 5,15.08H19C20.1,15.08 21,15.98 21,17.08V19.08C21,20.18 20.1,21.08 19,21.08H12.5M6.05,4.09C6.5,4.06 7.03,4.03 7.53,4.03C8.6,4.03 9.47,4.24 10.2,4.66C10.9,5.08 11.23,5.7 11.23,6.5C11.23,7.3 10.9,7.9 10.2,8.3C9.5,8.7 8.53,8.9 7.43,8.9H5.53V13.08H3V2.08H7.53C7.53,2.08 7.3,2.08 7.23,2.08C6.8,2.08 6.4,2.08 6,2.09C5.5,2.1 5.03,2.15 4.53,2.23L6.05,4.09M5.53,6.86H7.13C7.63,6.86 8.03,6.8 8.25,6.66C8.5,6.5 8.63,6.26 8.63,5.96C8.63,5.66 8.5,5.4 8.25,5.26C8.03,5.1 7.6,5.03 7,5.03C6.4,5.03 5.9,5.08 5.53,5.16V6.86M17,13.08H14V2.08H17V13.08Z"/></svg>
                            <strong id="rocksCount">0</strong>
                            <span>Rocks</span>
                        </div>
                        <div class="detection-item-icon">
                            <svg viewBox="0 0 24 24"><path d="M12,3L2,12H5V20H19V12H22L12,3Z" /></svg>
                            <strong id="baseCount">0</strong>
                            <span>Base</span>
                        </div>
                        <div class="detection-item-icon">
                           <svg viewBox="0 0 24 24"><path d="M14.4,6L14,4H5V21H7V14H12.6L13,16H20V6H14.4Z" /></svg>
                            <strong id="flagsCount">0</strong>
                            <span>Flags</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M3,4H21V6H3V4M3,11H21V13H3V11M3,18H21V20H3V18Z" /></svg>
                    <h3>Activity Log</h3>
                </div>
                <div class="card-content">
                    <div id="activityLog" class="log-container"></div>
                </div>
            </div>

             <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" /></svg>
                    <h3>Advanced Panel</h3>
                </div>
                 <div class="card-content">
                       <div class="theme-switcher">
                            <span>Toggle Theme</span>
                            <label class="switch">
                                 <input type="checkbox" id="theme-toggle">
                                 <span class="slider round"></span>
                            </label>
                          </div>
                          <p class="text-muted" style="margin-top: 15px;">More advanced settings and system overrides will be available here.</p>
                 </div>
            </div>

        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.18.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>

    <script src="/static/dashboard.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let model;

        // 3D model setup
        function init3DModel() {
            const container = document.getElementById('rover-3d-container');
            if (!container) return;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 2, 8);

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            const pointLight = new THREE.PointLight(0xffffff, 0.5);
            pointLight.position.set(-10, -5, -10);
            scene.add(pointLight);

            const mtlLoader = new THREE.MTLLoader();
            mtlLoader.setPath('/static/models/');
            mtlLoader.load('rover.mtl', function(materials) {
                materials.preload();
                const objLoader = new THREE.OBJLoader();
                objLoader.setMaterials(materials);
                objLoader.setPath('/static/models/');
                objLoader.load('rover.obj', function(object) {
                    model = object;
                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3()).length();
                    const center = box.getCenter(new THREE.Vector3());
                    model.position.sub(center);
                    model.scale.multiplyScalar(8.5 / size);
                    scene.add(model);
                    console.log('3D Rover loaded');
                }, undefined, (error) => {
                    console.error('Error loading .obj', error);
                    container.innerText = "Error loading 3D model.";
                });
            }, undefined, (error) => {
                console.error('Error loading .mtl', error);
            });

            const clock = new THREE.Clock();
            function animate() {
                requestAnimationFrame(animate);
                const elapsedTime = clock.getElapsedTime();
                if (model) {
                    model.position.y = Math.sin(elapsedTime * 1.5) * 0.05;
                    model.rotation.y += 0.002;
                }
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }

        init3DModel();

        // UI listeners
        document.getElementById('expand-controls-btn').addEventListener('click', function() {
            const panel = document.getElementById('advanced-controls-panel');
            panel.classList.toggle('expanded');
            this.textContent = panel.classList.contains('expanded') ? 'Advanced Controls ‚ñ≤' : 'Advanced Controls ‚ñº';
        });
        document.getElementById('customLinear').addEventListener('input', (e) => {
            document.getElementById('linearValue').textContent = e.target.value;
        });
        document.getElementById('customAngular').addEventListener('input', (e) => {
            document.getElementById('angularValue').textContent = e.target.value;
        });
        document.querySelectorAll('.fullscreen-btn').forEach(btn => {
            btn.addEventListener('click', (e) => e.target.closest('.card').classList.toggle('fullscreen'));
        });
        document.getElementById('theme-toggle').addEventListener('change', function() {
            document.body.setAttribute('data-theme', this.checked ? 'light' : '');
            if (!this.checked) document.body.removeAttribute('data-theme');
        });

        // animations & particles
        gsap.registerPlugin(ScrollTrigger);
        particlesJS('particles-js', {
          "particles": {
            "number": { "value": 200, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#ffffff" }, "shape": { "type": "circle" },
            "opacity": { "value": 0.8, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1, "sync": false } },
            "size": { "value": 1.5, "random": true, "anim": { "enable": false } },
            "line_linked": { "enable": false },
            "move": { "enable": true, "speed": 0.2, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false }
          },
          "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false } } },
          "retina_detect": true
        });

        const tl = gsap.timeline({ defaults: { ease: "power3.out" } });
        tl.from(".hero-title", { duration: 0.8, y: 30, opacity: 0 })
          .from(".hero-subtitle", { duration: 0.8, y: 20, opacity: 0 }, "-=0.6")
          .from(".hero-description", { duration: 0.8, y: 20, opacity: 0 }, "-=0.7")
          .from("#rover-3d-container", { duration: 1.2, y: 50, opacity: 0, ease: "elastic.out(1, 0.5)" }, "-=0.6")
          .from(".launch-button", { duration: 0.5, y: 20, opacity: 0 }, "-=0.8");

        gsap.utils.toArray('.card').forEach(card => {
            gsap.to(card, {
                opacity: 1, y: 0,
                scrollTrigger: {
                    trigger: card, start: "top 90%",
                    toggleActions: "play none none none", once: true
                },
                duration: 0.6, ease: "power2.out"
            });
        });

        // parallax for 3D model
        document.querySelector('.hero').addEventListener('mousemove', (e) => {
            if (!model) return;
            const x = (e.clientX / window.innerWidth) - 0.5;
            const y = (e.clientY / window.innerHeight) - 0.5;
            gsap.to(model.rotation, {
                duration: 1.5,
                y: x * Math.PI * 0.5,
                x: y * Math.PI * 0.25,
                ease: "power2.out"
            });
        });

        // scroll progress bar
        window.addEventListener('scroll', () => {
            const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrolled = (window.scrollY / scrollableHeight) * 100;
            document.getElementById('scroll-progress-bar').style.width = `${scrolled}%`;
        });
    });

    // Dashboard interaction stubs
    function moveForward(){ if(window.dashboardSend) dashboardSend({cmd:'move',x:1}); }
    function moveBackward(){ if(window.dashboardSend) dashboardSend({cmd:'move',x:-1}); }
    function moveLeft(){ if(window.dashboardSend) dashboardSend({cmd:'turn',z:0.5}); }
    function moveRight(){ if(window.dashboardSend) dashboardSend({cmd:'turn',z:-0.5}); }
    function emergencyStop(){ if(window.dashboardSend) dashboardSend({cmd:'stop'}); }
    function sendCustomCommand(){
        const l = parseFloat(document.getElementById('customLinear').value);
        const a = parseFloat(document.getElementById('customAngular').value);
        const d = parseFloat(document.getElementById('customDuration').value);
        if(window.dashboardSend) dashboardSend({cmd:'custom',linear:l,angular:a,duration:d});
    }
    function sendGoal(x,y){ if(window.dashboardSend) dashboardSend({cmd:'goal',x:x,y:y}); }
    function sendCustomGoal(){
        const x = parseFloat(document.getElementById('goalX').value) || 0;
        const y = parseFloat(document.getElementById('goalY').value) || 0;
        sendGoal(x,y);
    }
    </script>
</body>
</html>
