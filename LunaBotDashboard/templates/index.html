<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunaBot Autonomous Navigation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="scroll-progress-bar"></div>
    <div id="toast-container"></div>

    <section class="hero">
<div class="hero-bg-blobs">
  <div class="hero-blob1"></div>
  <div class="hero-blob2"></div>
  <div class="hero-blob3"></div>
</div>
        <div id="particles-js"></div>
        <div class="hero-content">
            <div class="hero-left">
                <h1 class="hero-title">LunaBot Autonomous Navigation</h1>
                <p class="hero-subtitle">SLAM-Based Rover Control System</p>
                <p class="hero-description">Advanced autonomous navigation with real-time SLAM mapping, computer vision detection, and intelligent path planning. Experience cutting-edge robotics technology designed for lunar exploration and beyond.</p>
            </div>
            <div class="hero-right">
                <div class="rover-container">
                    <div id="rover-3d-container" class="rover-image"></div>
                </div>
            </div>
        </div>
<button class="launch-button group btn-hero" onclick="document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });" aria-label="Launch Controls">
  <span class="launch-btn-text btn-label">LAUNCH CONTROLS</span>

  <span class="launch-btn-nav btn-reveal" aria-hidden="true">
    <span>LAUNCH CONTROLS</span>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path d="M5 12h14"></path>
      <path d="m12 5 7 7-7 7"></path>
    </svg>
  </span>

  <span class="launch-btn-bg btn-dot" aria-hidden="true"></span>
</button>


    </section>


    <header class="sticky-header">
        <h2>Control Dashboard</h2>
        <div class="connection-status">
            <span>Status:</span>
            <div id="connection-indicator" class="disconnected"></div>
            <span id="connection-text-header" class="disconnected">Disconnected</span>
            <span style="margin-left: 15px;">|</span>
   <span id="latency-indicator" style="margin-left: 15px;">
  <span id="latency-dot"></span>
  <span id="latency-text">Latency: -- ms</span>
</span>


                <span style="margin-left: 15px;">|</span>
                <span style="margin-left: 15px;">
                    <span id="trafficIcon" style="font-size: 1.1em;">üì°</span>
                    <strong id="networkTraffic" style="color: #00d4ff;">0 KB/s</strong>
                    <span style="color: var(--text-muted); font-size: 0.9em;">
                        (<strong id="messageRate" style="color: #00d4ff;">0</strong> msg/s)
                    </span>
                </span>
            <span style="margin-left: 15px;">|</span>
            <span style="margin-left: 15px;">üå°Ô∏è Temp: <strong id="moon-temp">- ¬∞C</strong></span>
        </div>
    </header>

    <main class="dashboard-container" id="dashboard">
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,9L8,13H11V15H13V13H16L12,9Z" /></svg>
                    <h3>Manual Control</h3>
                </div>
                <div class="card-content">
                    <div class="d-pad">
                        <button id="move-forward" onclick="moveForward()">‚¨Ü</button>
                        <button id="move-left" onclick="moveLeft()">‚¨Ö</button>
                        <button id="stop" class="stop-btn" onclick="emergencyStop()">üõë</button>
                        <button id="move-right" onclick="moveRight()">‚û°</button>
                        <button id="move-backward" onclick="moveBackward()">‚¨á</button>
                    </div>
                    <button class="expand-btn" id="expand-controls-btn">Advanced Controls ‚ñº</button>
                    <div class="advanced-controls" id="advanced-controls-panel">
                        <div class="slider-group">
                            <label>Linear Speed: <span id="linearValue">0.5</span></label>
                            <input type="range" id="customLinear" min="0" max="2" step="0.1" value="0.5">
                        </div>
                        <div class="slider-group">
                            <label>Angular Speed: <span id="angularValue">0.3</span></label>
                            <input type="range" id="customAngular" min="0" max="1" step="0.05" value="0.3">
                        </div>
                        <div class="input-group">
                            <label for="customDuration">Duration (s): <span id="durationValue">1.0</span></label>
                            <input type="range" id="customDuration" min="0.1" max="5" step="0.1" value="1">
                        </div>
                        <button class="cta-btn" onclick="sendCustomCommand()">Send Command</button>
                    </div>
                </div>
            </div>

            <div class="card tall-card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,2C15.31,2 18,4.69 18,8C18,12.5 12,22 12,22C12,22 6,12.5 6,8C6,4.69 8.69,2 12,2M12,4.5A3.5,3.5 0 0,0 8.5,8C8.5,9.93 10.33,13.25 12,15.9C13.67,13.25 15.5,9.93 15.5,8A3.5,3.5 0 0,0 12,4.5Z" /></svg>
                    <h3>SLAM Map</h3>
                    <span id="mapStatus" class="status-text"></span>
                    <button class="fullscreen-btn">‚õ∂</button>
                </div>
                <div class="card-content canvas-container">
                    <div class="shimmer-wrapper"><canvas id="slamMapCanvas" width="800" height="600"></canvas></div>
                </div>
            </div>

            <div class="card" id="cameraCard">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" /></svg>
                    <h3>Camera Feed</h3>
                    <span id="cameraStatus" class="live-indicator">OFFLINE</span>
                    <button class="fullscreen-btn" onclick="toggleFullscreenCamera()">‚õ∂</button>
                </div>
                <div class="card-content canvas-container">
                    <div class="stream-wrapper" style="width: 100%; height: 100%; position: relative;">
                        <img id="cameraStream" 
                            src="http://localhost:8080/stream?topic=/camera/color/image_raw&type=mjpeg&quality=50" 
                            alt="Camera Stream"
                            style="display: none; width: 100%; height: 100%; object-fit: cover;">
                        <div class="shimmer-wrapper" id="cameraPlaceholder" style="display: flex; ">
                            <div style="color: var(--text-muted);">Waiting for camera...</div>
                        </div>
                    </div>
                </div>
            </div>

                        <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,12.5A1.5,1.5 0 0,1 10.5,11A1.5,1.5 0 0,1 12,9.5A1.5,1.5 0 0,1 13.5,11A1.5,1.5 0 0,1 12,12.5M12,4.5C15.86,4.5 19,7.63 19,11.5C19,15.36 15.86,18.5 12,18.5A7,7 0 0,1 5,11.5C5,7.63 8.13,4.5 12,4.5M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>
                    <h3>Navigation Goals</h3>
                </div>
                <div class="card-content">
                    <div class="goal-pad">
                        <button id="goal-north" onclick="goNorth()">North</button>
                        <button id="goal-west" onclick="goWest()">West</button>
                        <button id="goal-home" onclick="goHome()">Home</button>
                        <button id="goal-east" onclick="goEast()">East</button>
                        <button id="goal-south" onclick="goSouth()">South</button>
                    </div>
<div class="custom-goal">
  <input class="goal-input" type="number" id="goalX" placeholder="X Coordinate" value="10" aria-label="Goal X coordinate">
  <input class="goal-input" type="number" id="goalY" placeholder="Y Coordinate" value="0" aria-label="Goal Y coordinate">
  <button class="cta-btn" onclick="sendCustomGoal()"><span class="btn-text">Set Custom Goal</span></button>
</div>

                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M2,2H11V11H2V2M4,4V9H9V4H4M13,2H22V11H13V2M15,4V9H20V4H15M2,13H11V22H2V13M4,15V20H9V15H4M17.5,13C15,13 13,15 13,17.5C13,20 15,22 17.5,22C20,22 22,20 22,17.5C22,15 20,13 17.5,13M17.5,15A2.5,2.5 0 0,1 20,17.5A2.5,2.5 0 0,1 17.5,20A2.5,2.5 0 0,1 15,17.5A2.5,2.5 0 0,1 17.5,15Z" /></svg>
                    <h3>Live Path Graph</h3>
                </div>
                <div class="card-content fixed-height">
                    <div id="pathMap"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M11,15V12H9V15H6V17H9V20H11V17H14V15H11Z" /></svg>
                    <h3>System Status</h3>
                </div>
                <div class="card-content fixed-height">
                    <div class="status-cards">
                        <div class="status-item">
                            <h4>Mode</h4>
                            <p id="missionMode">IDLE</p>
                        </div>
                        <div class="status-item">
                            <h4>Battery</h4>
                            <div class="battery-container">
                                <div class="battery-bar" id="batteryBar" style="width: 100%"></div>
                            </div>
                            <p id="missionBattery" style="margin-top: 5px;">100%</p>
                        </div>

                        <div class="status-item">
                            <h4>To Base</h4>
                            <p id="distanceToBase">0.0m</p>
                        </div>
                    </div>
                    <div class="status-rows">
                        <p>Position: <span id="positionDisplay">(0, 0, 0)</span></p>
                        <p>Velocity: <span id="velocityDisplay">(0, 0)</span></p>
                        <p>Rover Mode: <span id="modeDisplay">Manual</span></p>
                        <p>Speed: <span id="speedDisplay">0.0 m/s</span></p>
                        <p>Connection: <span id="connectionDisplay" class="status-ok">OK</span></p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" /></svg>
                    <h3>Object Detection</h3>
                </div>
                <div class="card-content">
                    <div class="detection-icons-grid">
                        <div class="detection-item-icon">
                            <svg viewBox="0 0 24 24"><path d="M12.5,21.08C9.8,21.08 5,21.08 5,21.08C3.9,21.08 3,20.18 3,19.08V17.08C3,15.98 3.9,15.08 5,15.08H19C20.1,15.08 21,15.98 21,17.08V19.08C21,20.18 20.1,21.08 19,21.08H12.5M6.05,4.09C6.5,4.06 7.03,4.03 7.53,4.03C8.6,4.03 9.47,4.24 10.2,4.66C10.9,5.08 11.23,5.7 11.23,6.5C11.23,7.3 10.9,7.9 10.2,8.3C9.5,8.7 8.53,8.9 7.43,8.9H5.53V13.08H3V2.08H7.53C7.53,2.08 7.3,2.08 7.23,2.08C6.8,2.08 6.4,2.08 6,2.09C5.5,2.1 5.03,2.15 4.53,2.23L6.05,4.09M5.53,6.86H7.13C7.63,6.86 8.03,6.8 8.25,6.66C8.5,6.5 8.63,6.26 8.63,5.96C8.63,5.66 8.5,5.4 8.25,5.26C8.03,5.1 7.6,5.03 7,5.03C6.4,5.03 5.9,5.08 5.53,5.16V6.86M17,13.08H14V2.08H17V13.08Z"/></svg>
                            <strong id="rocksCount">0</strong>
                            <span>Rocks</span>
                        </div>
                        <div class="detection-item-icon">
                            <svg viewBox="0 0 24 24"><path d="M12,3L2,12H5V20H19V12H22L12,3Z" /></svg>
                            <strong id="baseCount">0</strong>
                            <span>Base</span>
                        </div>
                        <div class="detection-item-icon">
                           <svg viewBox="0 0 24 24"><path d="M14.4,6L14,4H5V21H7V14H12.6L13,16H20V6H14.4Z" /></svg>
                            <strong id="flagsCount">0</strong>
                            <span>Flags</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M3,4H21V6H3V4M3,11H21V13H3V11M3,18H21V20H3V18Z" /></svg>
                    <h3>Activity Log</h3>
                </div>
                <div class="card-content">
                    <div id="activityLog" class="log-container"></div>
                </div>
            </div>


            <div class="card">
        <div class="card-header">
            <svg class="card-header-icon" viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" /></svg>
            <h3>Advanced Panel</h3>
        </div>
        <div class="card-content">
            <div class="theme-switcher">
                <span>Toggle Theme</span>
                <label class="switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
            
            <button class="cta-btn" onclick="resetNavigation()" style="width: 100%; margin-top: 20px;">
                üîÑ Reset Navigation
            </button>
            <button onclick="downloadDashboardData()" class="cta-btn">Download Dashboard Data</button>

            
            <p class="text-muted" style="margin-top: 15px;">More advanced settings and system overrides will be available here.</p>
        </div>
            </div>
<div class="card system-metrics-card">
    <div class="glow-effect glow-blue"></div>
    <div class="glow-effect glow-gold"></div>
    
    <div class="metrics-grid">
        <div class="metric-item cpu-section">
            <div class="metric-header">
                <span class="metric-label">CPU Usage</span>
                <div class="metric-tags">
                    <span class="tag-cyan">Peak</span>
                    <span class="tag-text">Live</span>
                </div>
            </div>
            <div class="metric-main-row">
                <span class="metric-value-giant" id="cpu-value">0%</span>
                <div class="sparkline-wrapper">
                    <svg class="sparkline-svg" viewBox="0 0 100 50" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="cpu-grad" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="#00d4ff" stop-opacity="0.4"/>
                                <stop offset="100%" stop-color="#00d4ff" stop-opacity="0"/>
                            </linearGradient>
                        </defs>
                        <path id="cpu-sparkline-fill" d="M0,50 L100,50 Z" fill="url(#cpu-grad)" stroke="none" />
                        <path id="cpu-sparkline-path" d="M0,50 L100,50" fill="none" stroke="#00d4ff" stroke-width="2" vector-effect="non-scaling-stroke"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="metric-item gpu-section">
            <div class="metric-header"><span class="metric-label">GPU Usage</span></div>
            <div class="radial-layout">
                <div class="radial-chart">
                    <svg viewBox="0 0 80 80">
                        <circle class="radial-bg" cx="40" cy="40" r="36"></circle>
                        <circle class="radial-fg gpu-stroke" id="gpu-ring" cx="40" cy="40" r="36"></circle>
                    </svg>
                    <div class="radial-inner-text" id="gpu-value">0%</div>
                </div>
                <div class="metric-info">
                    <span class="info-big" id="gpu-big-text">0%</span>
                    <span class="info-small" id="gpu-details">Load</span>
                </div>
            </div>
        </div>

        <div class="metric-item ram-section">
            <div class="metric-header"><span class="metric-label">RAM Usage</span></div>
            <div class="radial-layout">
                <div class="radial-chart">
                    <svg viewBox="0 0 80 80">
                        <circle class="radial-bg" cx="40" cy="40" r="36"></circle>
                        <circle class="radial-fg ram-stroke" id="ram-ring" cx="40" cy="40" r="36"></circle>
                    </svg>
                    <div class="radial-inner-text" id="ram-value">0%</div>
                </div>
                <div class="metric-info">
                    <span class="info-big" id="ram-big-text">0%</span>
                    <span class="info-small" id="ram-details">-- / -- GB</span>
                </div>
            </div>
        </div>

        <div class="metric-item temp-section">
            <div class="metric-header"><span class="metric-label">GPU Temp</span></div>
            <div class="temp-header-row">
                <span class="temp-val-main" id="temp-value">0¬∞C</span>
                <span class="temp-val-max">Max 85¬∞C</span>
            </div>
            <div class="temp-track">
                <div class="temp-fill" id="temp-bar" style="width: 0%;"></div>
            </div>
            <div class="temp-footer">Safe Operating Range</div>
        </div>
    </div>
</div>



        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>

    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let model;

        function init3DModel() {
    const container = document.getElementById('rover-3d-container');
    if (!container) return;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(0, 2, 8);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setClearColor(0x000000, 0);
    container.appendChild(renderer.domElement);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
    directionalLight.position.set(10, 10, 5);
    scene.add(directionalLight);
    const pointLight = new THREE.PointLight(0xffffff, 0.5);
    pointLight.position.set(-10, -5, -10);
    scene.add(pointLight);

    const mtlLoader = new THREE.MTLLoader();
    mtlLoader.setPath('/static/models/');
    mtlLoader.load('rover.mtl', function(materials) {
        materials.preload();
        const objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('/static/models/');
        objLoader.load('rover.obj', function(object) {
            model = object;
            const box = new THREE.Box3().setFromObject(model);
            const size = box.getSize(new THREE.Vector3()).length();
            const center = box.getCenter(new THREE.Vector3());
            model.position.sub(center);
            model.scale.multiplyScalar(8.5 / size);
            scene.add(model);
            console.log('3D Rover loaded');
        }, undefined, (error) => {
            console.error('Error loading .obj', error);
            container.innerText = "Error loading 3D model.";
        });
    }, undefined, (error) => {
        console.error('Error loading .mtl', error);
    });

    const clock = new THREE.Clock();
    function animate() {
        requestAnimationFrame(animate);
        const elapsedTime = clock.getElapsedTime();
        if (model) {
            model.position.y = Math.sin(elapsedTime * 1.5) * 0.05;
            model.rotation.y += 0.002;
        }
        renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });
}


        init3DModel();

        document.getElementById('expand-controls-btn').addEventListener('click', function() {
            const panel = document.getElementById('advanced-controls-panel');
            panel.classList.toggle('expanded');
            this.textContent = panel.classList.contains('expanded') ? 'Advanced Controls ‚ñ≤' : 'Advanced Controls ‚ñº';
        });
        document.getElementById('customLinear').addEventListener('input', (e) => {
            document.getElementById('linearValue').textContent = e.target.value;
        });
        document.getElementById('customAngular').addEventListener('input', (e) => {
            document.getElementById('angularValue').textContent = e.target.value;
        });
        document.getElementById('customDuration').addEventListener('input', (e) => {
            document.getElementById('durationValue').textContent = e.target.value;
        });
            
        document.getElementById('theme-toggle').addEventListener('change', function() {
            document.body.setAttribute('data-theme', this.checked ? 'light' : '');
            if (!this.checked) document.body.removeAttribute('data-theme');
        });

        gsap.registerPlugin(ScrollTrigger);
        particlesJS('particles-js', {
          "particles": {
            "number": { "value": 200, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#ffffff" }, "shape": { "type": "circle" },
            "opacity": { "value": 0.8, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1, "sync": false } },
            "size": { "value": 1.5, "random": true, "anim": { "enable": false } },
            "line_linked": { "enable": false },
            "move": { "enable": true, "speed": 0.2, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false }
          },
          "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false } } },
          "retina_detect": true
        });

        const tl = gsap.timeline({ defaults: { ease: "power3.out" } });
        tl.from(".hero-title", { duration: 0.8, y: 30, opacity: 0 })
          .from(".hero-subtitle", { duration: 0.8, y: 20, opacity: 0 }, "-=0.6")
          .from(".hero-description", { duration: 0.8, y: 20, opacity: 0 }, "-=0.7")
          .from("#rover-3d-container", { duration: 1.2, y: 50, opacity: 0, ease: "elastic.out(1, 0.5)" }, "-=0.6");

        gsap.utils.toArray('.card').forEach(card => {
            gsap.to(card, {
                opacity: 1, y: 0,
                scrollTrigger: {
                    trigger: card, start: "top 90%",
                    toggleActions: "play none none none", once: true
                },
                duration: 0.6, ease: "power2.out"
            });
        });

(() => {
    const container = document.getElementById('rover-3d-container');
    if (!container) return;

    let rect = container.getBoundingClientRect();

    const updateRect = () => {
        rect = container.getBoundingClientRect();
    };

    window.addEventListener('resize', updateRect);
    container.addEventListener('mouseenter', updateRect);

    container.addEventListener('mousemove', (e) => {
        if (!model) return;

        const localX = (e.clientX - rect.left) / rect.width;
        const localY = (e.clientY - rect.top) / rect.height;

        let x = localX - 0.5;
        let y = localY - 0.5;

        x = Math.max(-0.5, Math.min(0.5, x));
        y = Math.max(-0.5, Math.min(0.5, y));

        y = -y;

        const MAX_ROT_Y = Math.PI;
        const MAX_ROT_X = Math.PI / 3;

        const rotY = x * 2 * MAX_ROT_Y;
        const rotX = y * 2 * MAX_ROT_X;

        gsap.to(model.rotation, {
            duration: 0.6,
            y: rotY,
            x: rotX,
            ease: "power2.out"
        });
    });

    container.addEventListener('mouseleave', () => {
        if (!model) return;

        gsap.to(model.rotation, {
            duration: 0.6,
            x: 0,
            y: 0,
            ease: "power2.out"
        });
    });
})();


        window.addEventListener('scroll', () => {
            const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrolled = (window.scrollY / scrollableHeight) * 100;
            document.getElementById('scroll-progress-bar').style.width = `${scrolled}%`;
        });
    });

    </script>
</body>
</html>
